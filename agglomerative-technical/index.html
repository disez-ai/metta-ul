
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://SNetGrant.github.io/metta-ul/agglomerative-technical/">
      
      
        <link rel="prev" href="../agglomerative-api-reference/">
      
      
        <link rel="next" href="../visualization/">
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Technical - Clustering Algorithms in MeTTa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agglomerative-clustering-in-metta" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Clustering Algorithms in MeTTa" class="md-header__button md-logo" aria-label="Clustering Algorithms in MeTTa" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Clustering Algorithms in MeTTa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Technical
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../kmeans-api-reference/" class="md-tabs__link">
          
  
  
    
  
  Clustering

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../visualization/" class="md-tabs__link">
          
  
  
    
  
  Guides

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Clustering Algorithms in MeTTa" class="md-nav__button md-logo" aria-label="Clustering Algorithms in MeTTa" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Clustering Algorithms in MeTTa
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Clustering
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Clustering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    KMeans
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            KMeans
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kmeans-api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kmeans-technical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    GMM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            GMM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gmm-api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gmm-technical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Spectral
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Spectral
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spectral-api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spectral-technical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spectral-method/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Method
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Bisecting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Bisecting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bisecting-kmeans-api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bisecting-kmeans-technical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Agglomerative
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Agglomerative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agglomerative-api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Technical
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      Abstract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#algorithm-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metta-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      MeTTa Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeTTa Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-distance-matrix-agglomerativedistance-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      1. Distance Matrix (agglomerative.distance-matrix)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-linkage-function-agglomerativelinkage-distance" class="md-nav__link">
    <span class="md-ellipsis">
      2. Linkage Function (agglomerative.linkage-distance)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-heap-initialization-agglomerativeheapify" class="md-nav__link">
    <span class="md-ellipsis">
      3. Heap Initialization (agglomerative.heapify)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-heap-update-agglomerativeheappush" class="md-nav__link">
    <span class="md-ellipsis">
      4. Heap Update (agglomerative.heappush)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-union-find-recursion-agglomerativerecursion" class="md-nav__link">
    <span class="md-ellipsis">
      5. Union-Find Recursion (agglomerative.recursion)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-cluster-routine-agglomerativecluster" class="md-nav__link">
    <span class="md-ellipsis">
      6. Cluster Routine (agglomerative.cluster)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-cluster-assignment-agglomerativeassign" class="md-nav__link">
    <span class="md-ellipsis">
      7. Cluster Assignment (agglomerative.assign)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-api-entry-point-agglomerativefit-predict" class="md-nav__link">
    <span class="md-ellipsis">
      8. API Entry Point (agglomerative.fit-predict)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-naive-agglomerative-eg-scikit-learn" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with Naive Agglomerative (e.g., scikit-learn)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmark-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmark Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations-future-work" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations &amp; Future Work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limitations &amp; Future Work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#planned-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Planned Extensions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtualization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      Abstract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#algorithm-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Algorithm Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metta-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      MeTTa Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeTTa Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-distance-matrix-agglomerativedistance-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      1. Distance Matrix (agglomerative.distance-matrix)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-linkage-function-agglomerativelinkage-distance" class="md-nav__link">
    <span class="md-ellipsis">
      2. Linkage Function (agglomerative.linkage-distance)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-heap-initialization-agglomerativeheapify" class="md-nav__link">
    <span class="md-ellipsis">
      3. Heap Initialization (agglomerative.heapify)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-heap-update-agglomerativeheappush" class="md-nav__link">
    <span class="md-ellipsis">
      4. Heap Update (agglomerative.heappush)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-union-find-recursion-agglomerativerecursion" class="md-nav__link">
    <span class="md-ellipsis">
      5. Union-Find Recursion (agglomerative.recursion)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-cluster-routine-agglomerativecluster" class="md-nav__link">
    <span class="md-ellipsis">
      6. Cluster Routine (agglomerative.cluster)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-cluster-assignment-agglomerativeassign" class="md-nav__link">
    <span class="md-ellipsis">
      7. Cluster Assignment (agglomerative.assign)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-api-entry-point-agglomerativefit-predict" class="md-nav__link">
    <span class="md-ellipsis">
      8. API Entry Point (agglomerative.fit-predict)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comparison-with-naive-agglomerative-eg-scikit-learn" class="md-nav__link">
    <span class="md-ellipsis">
      Comparison with Naive Agglomerative (e.g., scikit-learn)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmark-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmark Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#limitations-future-work" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations &amp; Future Work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Limitations &amp; Future Work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#planned-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Planned Extensions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="agglomerative-clustering-in-metta">Agglomerative Clustering in MeTTa</h1>
<p><strong>Author:</strong> Ramin Barati, Amirhossein Nouranizadeh, Farhoud Mojahedzadeh</p>
<p><strong>Date:</strong> July 29, 2025</p>
<p><strong>Version:</strong> 1.0</p>
<hr />
<h2 id="abstract">Abstract</h2>
<p>We present an implementation of agglomerative (hierarchical) clustering in the MeTTa programming language, incorporating a min-heap and union-find data structures for performance optimization. By avoiding repeated full pairwise searches and tracking cluster memberships with union-find, the algorithm achieves significantly improved performance over naive approaches. This report details the algorithm's design, MeTTa-specific implementations, and performance characteristics.</p>
<h2 id="introduction">Introduction</h2>
<p>Hierarchical clustering is widely used for grouping unlabeled data without requiring a priori knowledge of the number of clusters. Agglomerative clustering performs this by repeatedly merging the closest pair of clusters until the desired number of clusters is reached.</p>
<p>This MeTTa implementation is designed to:</p>
<ul>
<li>Demonstrate efficient recursive programming with MeTTa.</li>
<li>Serve as a high-performance clustering module for symbolic and numerical data.</li>
<li>Showcase how classical data structures (heap, union-find) can be expressed declaratively.</li>
</ul>
<h2 id="algorithm-overview">Algorithm Overview</h2>
<ol>
<li><strong>Distance Matrix Computation</strong>: Compute full pairwise distances between data points.</li>
<li><strong>Heap Initialization</strong>: Build a min-heap with the smallest distance for each point.</li>
<li><strong>Union-Find Initialization</strong>: Each point begins in its own set.</li>
<li><strong>Recursive Merge</strong>: Pop the heap to find the nearest cluster pair. If not already unified, merge them and update the heap with distances to the new cluster.</li>
<li><strong>Label Assignment</strong>: Assign a unique label to each disjoint set.</li>
</ol>
<h2 id="metta-implementation-details">MeTTa Implementation Details</h2>
<h3 id="1-distance-matrix-agglomerativedistance-matrix">1. <strong>Distance Matrix</strong> (<code>agglomerative.distance-matrix</code>)</h3>
<p>Computes an \$n \times n\$ matrix of pairwise Euclidean distances.</p>
<ul>
<li><em>Implementation</em>: Uses broadcasting via <code>np.expand_dims</code> and <code>np.linalg.norm</code>.</li>
<li><em>Time:</em> O(n²·d)</li>
<li><em>Memory:</em> O(n²)</li>
</ul>
<h3 id="2-linkage-function-agglomerativelinkage-distance">2. <strong>Linkage Function</strong> (<code>agglomerative.linkage-distance</code>)</h3>
<p>Computes distance between two clusters using a linkage criterion:</p>
<ul>
<li>
<p><strong>single</strong>: minimum pairwise distance</p>
</li>
<li>
<p><strong>complete</strong>: maximum pairwise distance</p>
</li>
<li>
<p><strong>average</strong>: mean pairwise distance</p>
</li>
<li>
<p><em>Time:</em> O(|C₁|·|C₂|)</p>
</li>
<li>
<p><em>Memory:</em> O(|C₁|·|C₂|)</p>
</li>
</ul>
<h3 id="3-heap-initialization-agglomerativeheapify">3. <strong>Heap Initialization</strong> (<code>agglomerative.heapify</code>)</h3>
<p>For each point, identifies its nearest neighbor and inserts the pair with their distance into a min-heap.</p>
<ul>
<li><em>Implementation</em>: Uses masked distance matrix to avoid self-pairing.</li>
<li><em>Time:</em> O(n²)</li>
<li><em>Memory:</em> O(n)</li>
</ul>
<h3 id="4-heap-update-agglomerativeheappush">4. <strong>Heap Update</strong> (<code>agglomerative.heappush</code>)</h3>
<p>After a merge, computes the distance between the new cluster and all remaining clusters and pushes these distances to the heap.</p>
<ul>
<li><em>Implementation</em>: Recursively compares new root with others using union-find and linkage function.</li>
<li><em>Time:</em> O(n·p) where p = cost of linkage calculation</li>
<li><em>Memory:</em> Heap contains up to O(n²) entries over time.</li>
</ul>
<h3 id="5-union-find-recursion-agglomerativerecursion">5. <strong>Union-Find Recursion</strong> (<code>agglomerative.recursion</code>)</h3>
<p>Recursive loop merges the closest cluster pair at each step, skipping pairs already unified.</p>
<ul>
<li>
<p><em>Implementation</em>:</p>
</li>
<li>
<p>Uses <code>UnionFind.areUnified</code> to avoid redundant merges.</p>
</li>
<li>After each merge, updates heap with new distances.</li>
<li><em>Time:</em> Worst-case O((n–k)·n²·p), where p is linkage cost</li>
<li><em>Memory:</em> Tail-recursive stack, union-find trees + heap</li>
</ul>
<h3 id="6-cluster-routine-agglomerativecluster">6. <strong>Cluster Routine</strong> (<code>agglomerative.cluster</code>)</h3>
<p>Main pipeline for clustering: computes distances, initializes heap and union-find, runs merge recursion.</p>
<ul>
<li><em>Time:</em> Aggregate of above steps</li>
<li><em>Memory:</em> Aggregate of above steps</li>
</ul>
<h3 id="7-cluster-assignment-agglomerativeassign">7. <strong>Cluster Assignment</strong> (<code>agglomerative.assign</code>)</h3>
<p>Labels each element according to the root of its union-find group.</p>
<ul>
<li><em>Time:</em> O(n)</li>
<li><em>Memory:</em> O(n)</li>
</ul>
<h3 id="8-api-entry-point-agglomerativefit-predict">8. <strong>API Entry Point</strong> (<code>agglomerative.fit-predict</code>)</h3>
<p>Wrapper that runs clustering and returns an <code>NPArray</code> of cluster labels.</p>
<ul>
<li><em>Time:</em> Total time from above steps</li>
<li><em>Memory:</em> O(n²)</li>
</ul>
<h2 id="comparison-with-naive-agglomerative-eg-scikit-learn">Comparison with Naive Agglomerative (e.g., scikit-learn)</h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>MeTTa Optimized Implementation</th>
<th>scikit‑learn</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linkage types</td>
<td>single, complete, average</td>
<td>ward, complete, average, single</td>
</tr>
<tr>
<td>Distance storage</td>
<td>full matrix (numpy)</td>
<td>condensed or sparse matrix</td>
</tr>
<tr>
<td>Search strategy</td>
<td>heap-based nearest-neighbor tracking</td>
<td>fast C loops, optional connectivity</td>
</tr>
<tr>
<td>Merge bookkeeping</td>
<td>union-find</td>
<td>tree / linkage matrix</td>
</tr>
<tr>
<td>Parallelization</td>
<td>not yet supported</td>
<td>not supported in <code>AgglomerativeClustering</code></td>
</tr>
<tr>
<td>Best-case runtime</td>
<td>O(n²·log n) with fast linkage</td>
<td>O(n²) for complete linkage</td>
</tr>
</tbody>
</table>
<h2 id="benchmark-setup">Benchmark Setup</h2>
<p><em>The allgorithm does not return in an acceptable time even for pretty small datasets (~20 samples).</em></p>
<h2 id="usage-example">Usage Example</h2>
<div class="highlight"><pre><span></span><code>(import! &amp;self metta_ul:cluster:agglomerative)

;; Run average-linkage clustering with k = 3
(let $labels (agglomerative.fit-predict $X 3 &quot;average&quot;)
    (println! $labels)
)
</code></pre></div>
<p>Where <code>$X</code> is of type <code>(NPArray ($n $d))</code>.</p>
<h2 id="limitations-future-work">Limitations &amp; Future Work</h2>
<ul>
<li><strong>Dense Distance Matrix</strong>: O(n²) memory use limits scalability.</li>
<li><strong>Heap Growth</strong>: No deduplication; heap may grow large unless compacted.</li>
<li><strong>Condensed Matrix Support</strong>: Could reduce memory footprint with careful index mapping.</li>
</ul>
<h3 id="planned-extensions">Planned Extensions:</h3>
<ul>
<li>Add support for sparse graph connectivity (e.g., radius or k-NN graphs).</li>
<li>Use priority queue with distance caching to avoid redundant linkage evaluations.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>This report documents a fast (in theory), modular, and expressive implementation of agglomerative clustering in MeTTa. The use of declarative recursion, heaps, and union-find enables realistic performance on medium-scale datasets and lays the groundwork for extending MeTTa into more advanced unsupervised learning domains. However, in practice, the allgorithm is extremely slow to execute even for pretty small datasets. This might be caused by the mentioned issue of heap growth. We might be able to alleviate this by replacing the leftist heap with an indexed heap, but that requires some implementation of a collection that has O(1) complexity in accessing the elements, otherwise no performance gain could be observed over this lazy strategy that we have implemented here.</p>
<h2 id="references">References</h2>
<ol>
<li>Johnson, S. C. (1967). Hierarchical clustering schemes.</li>
<li>Pedregosa et al. (2011). Scikit-learn: Machine learning in Python.</li>
<li>MeTTa Language Specification. <a href="http://www.metta-lang.dev">http://www.metta-lang.dev</a></li>
<li>Tarjan, R. E. (1975). Efficiency of a good but not linear set union algorithm.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/SNetGrant/metta-ul" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "search.suggest", "search.highlight", "search.share", "navigation.indexes", "toc.follow"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>